<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<style>
.container {
	min-width: 800px;
	max-width: 1600px;
	margin-left: 100px;
	height: 100vh;
}

.title-wrapper{
	margin-bottom: 30px;
}

.write-info-wrapper label{
	font-weight: bolder;
	margin-right: 5px;
}

.wirte-info-wrapper span{
	margin-right: 20px;
}

</style>

<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<script
  src="https://code.jquery.com/jquery-3.6.0.min.js"
  integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
  crossorigin="anonymous"></script>

</head>
<body>
	<div class="container">
		<h1>게시글 상세 페이지</h1>
		
		<form method="post" action="/boards" th:object="${boardDetail}">
		
			<div class="write-info-wrapper">
				<label>작성자</label>
				<span th:text="*{createAccountId}">작성자 아이디</span>
				<label>작성 날짜</label>
				<span th:text="*{createdAt}">작성일자</span>	
			</div>
			
			
			<div class="title-wrapper">
				<h4>
					<label for="title">게시글 제목</label>					
				</h4>
				<input type="hidden" name="idx" id="idx" readonly th:field="*{idx}">
				<input type="text" name="title" id="title" readonly th:field="*{title}">			
			</div>
			<div class="contents-wrapper">
				<h4>
					<label for="contents">게시글 내용</label>
				</h4>
				<textarea name="contents" id="contents" cols="30" rows="10" readonly th:field="*{contents}"></textarea>
			</div>
			
			<th:block th:if="${session.loginId != null && session.loginId == boardDetail.createAccountId}">
			<div class="btn-wrapper">
				<button type="button" onclick="editPage()">수정</button>
				<button type="button" onclick="deleteBoard()">게시글 삭제</button>
			</div>
			</th:block>
			
		</form>	
	</div>
</body>

<script th:inline="javascript">
	
	var boardDetail = [[${boardDetail}]];
	var boardIdx = boardDetail == null ? null : boardDetail.idx;
	
	//alert(boardIdx);
	
	function editPage() {
		var url = "/boards/" + boardIdx + "/edit";
		location.href = url;
	}
	
	function deleteBoard(){
		
		console.log(1);
		
		if(!confirm("게시글을 삭제하시겠습니까?")){
			return false;
		}
		console.log(2);
		
		var url = "/boards/" + boardIdx + "/delete";
		console.log(url);
		console.log(3);
		$.ajax({
			url: url,
			method: "DELETE",
			timeout: 5000,
			success: function(){
				alert("삭제되었습니다.");
				location.href = "/boards";
				},
				error: function(a, b){
					console.log(a);
				}
			});
			
	}
</script>

</html>